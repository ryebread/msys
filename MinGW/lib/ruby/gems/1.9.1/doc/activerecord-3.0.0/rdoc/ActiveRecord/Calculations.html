<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta content="text/html; charset=utf-8" http-equiv="Content-Type" />

	<title>Module: ActiveRecord::Calculations</title>

	<link rel="stylesheet" href="../rdoc.css" type="text/css" media="screen" />

	<script src="../js/jquery.js" type="text/javascript"
		charset="utf-8"></script>
	<script src="../js/thickbox-compressed.js" type="text/javascript"
		charset="utf-8"></script>
	<script src="../js/quicksearch.js" type="text/javascript"
		charset="utf-8"></script>
	<script src="../js/darkfish.js" type="text/javascript"
		charset="utf-8"></script>

</head>
<body class="module">

	<div id="metadata">
		<div id="home-metadata">
			<div id="home-section" class="section">
        <h3 class="section-header">
          <a href="../index.html">Home</a>
          <a href="../index.html#classes">Classes</a>
          <a href="../index.html#methods">Methods</a>
        </h3>
			</div>
		</div>

		<div id="file-metadata">
			<div id="file-list-section" class="section">
				<h3 class="section-header">In Files</h3>
				<div class="section-body">
					<ul>
					
						<li><a href="../lib/active_record/relation/calculations_rb.html?TB_iframe=true&amp;height=550&amp;width=785"
							class="thickbox" title="lib/active_record/relation/calculations.rb">lib/active_record/relation/calculations.rb</a></li>
					
					</ul>
				</div>
			</div>

			
		</div>

		<div id="class-metadata">

			<!-- Parent Class -->
			

			<!-- Namespace Contents -->
			

			<!-- Method Quickref -->
			
			<div id="method-list-section" class="section">
				<h3 class="section-header">Methods</h3>
				<ul class="link-list">
					
					<li><a href="#method-i-average">#average</a></li>
					
					<li><a href="#method-i-calculate">#calculate</a></li>
					
					<li><a href="#method-i-column_alias_for">#column_alias_for</a></li>
					
					<li><a href="#method-i-column_for">#column_for</a></li>
					
					<li><a href="#method-i-count">#count</a></li>
					
					<li><a href="#method-i-maximum">#maximum</a></li>
					
					<li><a href="#method-i-minimum">#minimum</a></li>
					
					<li><a href="#method-i-perform_calculation">#perform_calculation</a></li>
					
					<li><a href="#method-i-select_for_count">#select_for_count</a></li>
					
					<li><a href="#method-i-sum">#sum</a></li>
					
					<li><a href="#method-i-type_cast_calculated_value">#type_cast_calculated_value</a></li>
					
					<li><a href="#method-i-type_cast_using_column">#type_cast_using_column</a></li>
					
				</ul>
			</div>
			

			<!-- Included Modules -->
			
		</div>

		<div id="project-metadata">
			
			
			<div id="fileindex-section" class="section project-section">
				<h3 class="section-header">Files</h3>
				<ul>
				
					<li class="file"><a href="../README_rdoc.html">README.rdoc</a></li>
				
				</ul>
			</div>
			

			<div id="classindex-section" class="section project-section">
				<h3 class="section-header">Class Index
					<span class="search-toggle"><img src="../images/find.png"
						height="16" width="16" alt="[+]"
						title="show/hide quicksearch" /></span></h3>
				<form action="#" method="get" accept-charset="utf-8" class="initially-hidden">
				<fieldset>
					<legend>Quicksearch</legend>
					<input type="text" name="quicksearch" value=""
						class="quicksearch-field" />
				</fieldset>
				</form>

				<ul class="link-list">
				
					<li><a href="../ActiveRecord/ActiveRecordError.html">ActiveRecord::ActiveRecordError</a></li>
				
					<li><a href="../ActiveRecord/AdapterNotFound.html">ActiveRecord::AdapterNotFound</a></li>
				
					<li><a href="../ActiveRecord/AdapterNotSpecified.html">ActiveRecord::AdapterNotSpecified</a></li>
				
					<li><a href="../ActiveRecord/Aggregations/ClassMethods.html">ActiveRecord::Aggregations::ClassMethods</a></li>
				
					<li><a href="../ActiveRecord/AssociationPreload/ClassMethods.html">ActiveRecord::AssociationPreload::ClassMethods</a></li>
				
					<li><a href="../ActiveRecord/AssociationTypeMismatch.html">ActiveRecord::AssociationTypeMismatch</a></li>
				
					<li><a href="../ActiveRecord/Associations/ClassMethods.html">ActiveRecord::Associations::ClassMethods</a></li>
				
					<li><a href="../ActiveRecord/Associations/ClassMethods/o.html">ActiveRecord::Associations::ClassMethods::o</a></li>
				
					<li><a href="../ActiveRecord/Associations/HasOneThroughAssociation.html">ActiveRecord::Associations::HasOneThroughAssociation</a></li>
				
					<li><a href="../ActiveRecord/Associations/ThroughAssociationScope.html">ActiveRecord::Associations::ThroughAssociationScope</a></li>
				
					<li><a href="../ActiveRecord/AttributeAssignmentError.html">ActiveRecord::AttributeAssignmentError</a></li>
				
					<li><a href="../ActiveRecord/AttributeMethods/BeforeTypeCast.html">ActiveRecord::AttributeMethods::BeforeTypeCast</a></li>
				
					<li><a href="../ActiveRecord/AttributeMethods/ClassMethods.html">ActiveRecord::AttributeMethods::ClassMethods</a></li>
				
					<li><a href="../ActiveRecord/AttributeMethods/Dirty.html">ActiveRecord::AttributeMethods::Dirty</a></li>
				
					<li><a href="../ActiveRecord/AttributeMethods/PrimaryKey.html">ActiveRecord::AttributeMethods::PrimaryKey</a></li>
				
					<li><a href="../ActiveRecord/AttributeMethods/PrimaryKey/ClassMethods.html">ActiveRecord::AttributeMethods::PrimaryKey::ClassMethods</a></li>
				
					<li><a href="../ActiveRecord/AttributeMethods/Query.html">ActiveRecord::AttributeMethods::Query</a></li>
				
					<li><a href="../ActiveRecord/AttributeMethods/Read.html">ActiveRecord::AttributeMethods::Read</a></li>
				
					<li><a href="../ActiveRecord/AttributeMethods/Read/ClassMethods.html">ActiveRecord::AttributeMethods::Read::ClassMethods</a></li>
				
					<li><a href="../ActiveRecord/AttributeMethods/TimeZoneConversion.html">ActiveRecord::AttributeMethods::TimeZoneConversion</a></li>
				
					<li><a href="../ActiveRecord/AttributeMethods/TimeZoneConversion/ClassMethods.html">ActiveRecord::AttributeMethods::TimeZoneConversion::ClassMethods</a></li>
				
					<li><a href="../ActiveRecord/AttributeMethods/Write.html">ActiveRecord::AttributeMethods::Write</a></li>
				
					<li><a href="../ActiveRecord/AttributeMethods/Write/ClassMethods.html">ActiveRecord::AttributeMethods::Write::ClassMethods</a></li>
				
					<li><a href="../ActiveRecord/AutosaveAssociation.html">ActiveRecord::AutosaveAssociation</a></li>
				
					<li><a href="../ActiveRecord/AutosaveAssociation/ClassMethods.html">ActiveRecord::AutosaveAssociation::ClassMethods</a></li>
				
					<li><a href="../ActiveRecord/Base.html">ActiveRecord::Base</a></li>
				
					<li><a href="../ActiveRecord/Calculations.html">ActiveRecord::Calculations</a></li>
				
					<li><a href="../ActiveRecord/Callbacks.html">ActiveRecord::Callbacks</a></li>
				
					<li><a href="../ActiveRecord/Callbacks/ClassMethods.html">ActiveRecord::Callbacks::ClassMethods</a></li>
				
					<li><a href="../ActiveRecord/ConfigurationError.html">ActiveRecord::ConfigurationError</a></li>
				
					<li><a href="../ActiveRecord/ConnectionAdapters/AbstractAdapter.html">ActiveRecord::ConnectionAdapters::AbstractAdapter</a></li>
				
					<li><a href="../ActiveRecord/ConnectionAdapters/Column.html">ActiveRecord::ConnectionAdapters::Column</a></li>
				
					<li><a href="../ActiveRecord/ConnectionAdapters/Column/Format.html">ActiveRecord::ConnectionAdapters::Column::Format</a></li>
				
					<li><a href="../ActiveRecord/ConnectionAdapters/ConnectionHandler.html">ActiveRecord::ConnectionAdapters::ConnectionHandler</a></li>
				
					<li><a href="../ActiveRecord/ConnectionAdapters/ConnectionManagement.html">ActiveRecord::ConnectionAdapters::ConnectionManagement</a></li>
				
					<li><a href="../ActiveRecord/ConnectionAdapters/ConnectionPool.html">ActiveRecord::ConnectionAdapters::ConnectionPool</a></li>
				
					<li><a href="../ActiveRecord/ConnectionAdapters/DatabaseLimits.html">ActiveRecord::ConnectionAdapters::DatabaseLimits</a></li>
				
					<li><a href="../ActiveRecord/ConnectionAdapters/DatabaseStatements.html">ActiveRecord::ConnectionAdapters::DatabaseStatements</a></li>
				
					<li><a href="../ActiveRecord/ConnectionAdapters/MysqlAdapter.html">ActiveRecord::ConnectionAdapters::MysqlAdapter</a></li>
				
					<li><a href="../ActiveRecord/ConnectionAdapters/PostgreSQLAdapter.html">ActiveRecord::ConnectionAdapters::PostgreSQLAdapter</a></li>
				
					<li><a href="../ActiveRecord/ConnectionAdapters/PostgreSQLColumn.html">ActiveRecord::ConnectionAdapters::PostgreSQLColumn</a></li>
				
					<li><a href="../ActiveRecord/ConnectionAdapters/QueryCache.html">ActiveRecord::ConnectionAdapters::QueryCache</a></li>
				
					<li><a href="../ActiveRecord/ConnectionAdapters/Quoting.html">ActiveRecord::ConnectionAdapters::Quoting</a></li>
				
					<li><a href="../ActiveRecord/ConnectionAdapters/SQLiteAdapter.html">ActiveRecord::ConnectionAdapters::SQLiteAdapter</a></li>
				
					<li><a href="../ActiveRecord/ConnectionAdapters/SQLiteAdapter/Version.html">ActiveRecord::ConnectionAdapters::SQLiteAdapter::Version</a></li>
				
					<li><a href="../ActiveRecord/ConnectionAdapters/SchemaStatements.html">ActiveRecord::ConnectionAdapters::SchemaStatements</a></li>
				
					<li><a href="../ActiveRecord/ConnectionAdapters/Table.html">ActiveRecord::ConnectionAdapters::Table</a></li>
				
					<li><a href="../ActiveRecord/ConnectionAdapters/TableDefinition.html">ActiveRecord::ConnectionAdapters::TableDefinition</a></li>
				
					<li><a href="../ActiveRecord/ConnectionNotEstablished.html">ActiveRecord::ConnectionNotEstablished</a></li>
				
					<li><a href="../ActiveRecord/ConnectionTimeoutError.html">ActiveRecord::ConnectionTimeoutError</a></li>
				
					<li><a href="../ActiveRecord/CounterCache.html">ActiveRecord::CounterCache</a></li>
				
					<li><a href="../ActiveRecord/DangerousAttributeError.html">ActiveRecord::DangerousAttributeError</a></li>
				
					<li><a href="../ActiveRecord/DynamicFinderMatch.html">ActiveRecord::DynamicFinderMatch</a></li>
				
					<li><a href="../ActiveRecord/DynamicScopeMatch.html">ActiveRecord::DynamicScopeMatch</a></li>
				
					<li><a href="../ActiveRecord/FinderMethods.html">ActiveRecord::FinderMethods</a></li>
				
					<li><a href="../ActiveRecord/Generators.html">ActiveRecord::Generators</a></li>
				
					<li><a href="../ActiveRecord/Generators/MigrationGenerator.html">ActiveRecord::Generators::MigrationGenerator</a></li>
				
					<li><a href="../ActiveRecord/Generators/ModelGenerator.html">ActiveRecord::Generators::ModelGenerator</a></li>
				
					<li><a href="../ActiveRecord/Generators/ObserverGenerator.html">ActiveRecord::Generators::ObserverGenerator</a></li>
				
					<li><a href="../ActiveRecord/Generators/SessionMigrationGenerator.html">ActiveRecord::Generators::SessionMigrationGenerator</a></li>
				
					<li><a href="../ActiveRecord/InvalidForeignKey.html">ActiveRecord::InvalidForeignKey</a></li>
				
					<li><a href="../ActiveRecord/IrreversibleMigration.html">ActiveRecord::IrreversibleMigration</a></li>
				
					<li><a href="../ActiveRecord/Locking.html">ActiveRecord::Locking</a></li>
				
					<li><a href="../ActiveRecord/Locking/Optimistic.html">ActiveRecord::Locking::Optimistic</a></li>
				
					<li><a href="../ActiveRecord/Locking/Optimistic/ClassMethods.html">ActiveRecord::Locking::Optimistic::ClassMethods</a></li>
				
					<li><a href="../ActiveRecord/Locking/Pessimistic.html">ActiveRecord::Locking::Pessimistic</a></li>
				
					<li><a href="../ActiveRecord/LogSubscriber.html">ActiveRecord::LogSubscriber</a></li>
				
					<li><a href="../ActiveRecord/Migration.html">ActiveRecord::Migration</a></li>
				
					<li><a href="../ActiveRecord/MigrationProxy.html">ActiveRecord::MigrationProxy</a></li>
				
					<li><a href="../ActiveRecord/MultiparameterAssignmentErrors.html">ActiveRecord::MultiparameterAssignmentErrors</a></li>
				
					<li><a href="../ActiveRecord/NamedScope.html">ActiveRecord::NamedScope</a></li>
				
					<li><a href="../ActiveRecord/NamedScope/ClassMethods.html">ActiveRecord::NamedScope::ClassMethods</a></li>
				
					<li><a href="../ActiveRecord/NestedAttributes/ClassMethods.html">ActiveRecord::NestedAttributes::ClassMethods</a></li>
				
					<li><a href="../ActiveRecord/NestedAttributes/TooManyRecords.html">ActiveRecord::NestedAttributes::TooManyRecords</a></li>
				
					<li><a href="../ActiveRecord/Observer.html">ActiveRecord::Observer</a></li>
				
					<li><a href="../ActiveRecord/Persistence.html">ActiveRecord::Persistence</a></li>
				
					<li><a href="../ActiveRecord/PredicateBuilder.html">ActiveRecord::PredicateBuilder</a></li>
				
					<li><a href="../ActiveRecord/PreparedStatementInvalid.html">ActiveRecord::PreparedStatementInvalid</a></li>
				
					<li><a href="../ActiveRecord/QueryCache.html">ActiveRecord::QueryCache</a></li>
				
					<li><a href="../ActiveRecord/QueryCache/ClassMethods.html">ActiveRecord::QueryCache::ClassMethods</a></li>
				
					<li><a href="../ActiveRecord/QueryMethods.html">ActiveRecord::QueryMethods</a></li>
				
					<li><a href="../ActiveRecord/Railtie.html">ActiveRecord::Railtie</a></li>
				
					<li><a href="../ActiveRecord/Railties.html">ActiveRecord::Railties</a></li>
				
					<li><a href="../ActiveRecord/Railties/ControllerRuntime.html">ActiveRecord::Railties::ControllerRuntime</a></li>
				
					<li><a href="../ActiveRecord/Railties/ControllerRuntime/ClassMethods.html">ActiveRecord::Railties::ControllerRuntime::ClassMethods</a></li>
				
					<li><a href="../ActiveRecord/ReadOnlyRecord.html">ActiveRecord::ReadOnlyRecord</a></li>
				
					<li><a href="../ActiveRecord/RecordInvalid.html">ActiveRecord::RecordInvalid</a></li>
				
					<li><a href="../ActiveRecord/RecordNotFound.html">ActiveRecord::RecordNotFound</a></li>
				
					<li><a href="../ActiveRecord/RecordNotSaved.html">ActiveRecord::RecordNotSaved</a></li>
				
					<li><a href="../ActiveRecord/RecordNotUnique.html">ActiveRecord::RecordNotUnique</a></li>
				
					<li><a href="../ActiveRecord/Reflection/ClassMethods.html">ActiveRecord::Reflection::ClassMethods</a></li>
				
					<li><a href="../ActiveRecord/Reflection/MacroReflection.html">ActiveRecord::Reflection::MacroReflection</a></li>
				
					<li><a href="../ActiveRecord/Relation.html">ActiveRecord::Relation</a></li>
				
					<li><a href="../ActiveRecord/Rollback.html">ActiveRecord::Rollback</a></li>
				
					<li><a href="../ActiveRecord/Schema.html">ActiveRecord::Schema</a></li>
				
					<li><a href="../ActiveRecord/Serialization.html">ActiveRecord::Serialization</a></li>
				
					<li><a href="../ActiveRecord/SerializationTypeMismatch.html">ActiveRecord::SerializationTypeMismatch</a></li>
				
					<li><a href="../ActiveRecord/SessionStore.html">ActiveRecord::SessionStore</a></li>
				
					<li><a href="../ActiveRecord/SessionStore/Session.html">ActiveRecord::SessionStore::Session</a></li>
				
					<li><a href="../ActiveRecord/SessionStore/SqlBypass.html">ActiveRecord::SessionStore::SqlBypass</a></li>
				
					<li><a href="../ActiveRecord/SpawnMethods.html">ActiveRecord::SpawnMethods</a></li>
				
					<li><a href="../ActiveRecord/StaleObjectError.html">ActiveRecord::StaleObjectError</a></li>
				
					<li><a href="../ActiveRecord/StatementInvalid.html">ActiveRecord::StatementInvalid</a></li>
				
					<li><a href="../ActiveRecord/TestFixtures.html">ActiveRecord::TestFixtures</a></li>
				
					<li><a href="../ActiveRecord/TestFixtures/ClassMethods.html">ActiveRecord::TestFixtures::ClassMethods</a></li>
				
					<li><a href="../ActiveRecord/ThrowResult.html">ActiveRecord::ThrowResult</a></li>
				
					<li><a href="../ActiveRecord/Timestamp.html">ActiveRecord::Timestamp</a></li>
				
					<li><a href="../ActiveRecord/Transactions.html">ActiveRecord::Transactions</a></li>
				
					<li><a href="../ActiveRecord/Transactions/ClassMethods.html">ActiveRecord::Transactions::ClassMethods</a></li>
				
					<li><a href="../ActiveRecord/UnknownAttributeError.html">ActiveRecord::UnknownAttributeError</a></li>
				
					<li><a href="../ActiveRecord/Validations.html">ActiveRecord::Validations</a></li>
				
					<li><a href="../ActiveRecord/Validations/AssociatedValidator.html">ActiveRecord::Validations::AssociatedValidator</a></li>
				
					<li><a href="../ActiveRecord/Validations/ClassMethods.html">ActiveRecord::Validations::ClassMethods</a></li>
				
					<li><a href="../ActiveRecord/Validations/UniquenessValidator.html">ActiveRecord::Validations::UniquenessValidator</a></li>
				
					<li><a href="../ActiveRecord/WrappedDatabaseException.html">ActiveRecord::WrappedDatabaseException</a></li>
				
					<li><a href="../Fixtures.html">Fixtures</a></li>
				
					<li><a href="../FixturesFileNotFound.html">FixturesFileNotFound</a></li>
				
				</ul>
				<div id="no-class-search-results" style="display: none;">No matching classes.</div>
			</div>

			
		</div>
	</div>

	<div id="documentation">
		<h1 class="module">ActiveRecord::Calculations</h1>

		<div id="description">
			
		</div>

		<!-- Constants -->
		

		<!-- Attributes -->
		

		<!-- Methods -->
		
		<div id="public-instance-method-details" class="method-section section">
			<h3 class="section-header">Public Instance Methods</h3>

		
			<div id="average-method" class="method-detail ">
				<a name="method-i-average"></a>

				<div class="method-heading">
				
					<span class="method-name">average</span><span
						class="method-args">(column_name, options = {})</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Calculates the average value on a given column. Returns <tt>nil</tt> if
there&#8217;s no row. See <tt>calculate</tt> for examples with options.
</p>
<pre>
  Person.average('age') # =&gt; 35.8</pre>
					

					
					<div class="method-source-code"
						id="average-source">
<pre>
    <span class="ruby-comment cmt"># File lib/active_record/relation/calculations.rb, line 65</span>
65:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">average</span>(<span class="ruby-identifier">column_name</span>, <span class="ruby-identifier">options</span> = {})
66:       <span class="ruby-identifier">calculate</span>(<span class="ruby-value">:average</span>, <span class="ruby-identifier">column_name</span>, <span class="ruby-identifier">options</span>)
67:     <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="calculate-method" class="method-detail ">
				<a name="method-i-calculate"></a>

				<div class="method-heading">
				
					<span class="method-name">calculate</span><span
						class="method-args">(operation, column_name, options = {})</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
This calculates aggregate values in the given column.  Methods for count,
sum, average, minimum, and maximum have been added as shortcuts. Options
such as <tt>:conditions</tt>, <tt>:order</tt>, <tt>:group</tt>,
<tt>:having</tt>, and <tt>:joins</tt> can be passed to customize the query.
</p>
<p>
There are two basic forms of output:
</p>
<pre>
  * Single aggregate value: The single value is type cast to Fixnum for COUNT, Float
    for AVG, and the given column's type for everything else.
  * Grouped values: This returns an ordered hash of the values and groups them by the
    &lt;tt&gt;:group&lt;/tt&gt; option.  It takes either a column name, or the name of a belongs_to association.

      values = Person.maximum(:age, :group =&gt; 'last_name')
      puts values[&quot;Drake&quot;]
      =&gt; 43

      drake  = Family.find_by_last_name('Drake')
      values = Person.maximum(:age, :group =&gt; :family) # Person belongs_to :family
      puts values[drake]
      =&gt; 43

      values.each do |family, max_age|
      ...
      end
</pre>
<p>
Options:
</p>
<ul>
<li><p>
<tt>:conditions</tt> - An SQL fragment like &#8220;administrator = 1&#8221;
or [ &#8220;user_name = ?&#8221;, username ]. See conditions in the intro
to <a href="Base.html">ActiveRecord::Base</a>.
</p>
</li>
<li><p>
<tt>:include</tt>: Eager loading, see Associations for details.  Since
calculations don&#8217;t load anything, the purpose of this is to access
fields on joined tables in your conditions, order, or group clauses.
</p>
</li>
<li><p>
<tt>:joins</tt> - An SQL fragment for additional joins like &#8220;LEFT
JOIN comments ON comments.post_id = id&#8221;. (Rarely needed). The records
will be returned read-only since they will have attributes that do not
correspond to the table&#8217;s columns.
</p>
</li>
<li><p>
<tt>:order</tt> - An SQL fragment like &#8220;created_at DESC, name&#8221;
(really only used with GROUP BY calculations).
</p>
</li>
<li><p>
<tt>:group</tt> - An attribute name by which the result should be grouped.
Uses the GROUP BY SQL-clause.
</p>
</li>
<li><p>
<tt>:select</tt> - By default, this is * as in SELECT * FROM, but can be
changed if you for example want to do a join, but not include the joined
columns.
</p>
</li>
<li><p>
<tt>:distinct</tt> - Set this to true to make this a distinct calculation,
such as SELECT COUNT(DISTINCT posts.id) &#8230;
</p>
</li>
</ul>
<p>
Examples:
</p>
<pre>
  Person.calculate(:count, :all) # The same as Person.count
  Person.average(:age) # SELECT AVG(age) FROM people...
  Person.minimum(:age, :conditions =&gt; ['last_name != ?', 'Drake']) # Selects the minimum age for
                                                                   # everyone with a last name other than 'Drake'

  # Selects the minimum age for any family without any minors
  Person.minimum(:age, :having =&gt; 'min(age) &gt; 17', :group =&gt; :last_name)

  Person.sum(&quot;2 * age&quot;)</pre>
					

					
					<div class="method-source-code"
						id="calculate-source">
<pre>
     <span class="ruby-comment cmt"># File lib/active_record/relation/calculations.rb, line 145</span>
145:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">operation</span>, <span class="ruby-identifier">column_name</span>, <span class="ruby-identifier">options</span> = {})
146:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>.<span class="ruby-identifier">except</span>(<span class="ruby-value">:distinct</span>).<span class="ruby-identifier">present?</span>
147:         <span class="ruby-identifier">apply_finder_options</span>(<span class="ruby-identifier">options</span>.<span class="ruby-identifier">except</span>(<span class="ruby-value">:distinct</span>)).<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">operation</span>, <span class="ruby-identifier">column_name</span>, <span class="ruby-value">:distinct</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:distinct</span>])
148:       <span class="ruby-keyword kw">else</span>
149:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">eager_loading?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">includes_values</span>.<span class="ruby-identifier">present?</span>
150:           <span class="ruby-identifier">construct_relation_for_association_calculations</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">operation</span>, <span class="ruby-identifier">column_name</span>, <span class="ruby-identifier">options</span>)
151:         <span class="ruby-keyword kw">else</span>
152:           <span class="ruby-identifier">perform_calculation</span>(<span class="ruby-identifier">operation</span>, <span class="ruby-identifier">column_name</span>, <span class="ruby-identifier">options</span>)
153:         <span class="ruby-keyword kw">end</span>
154:       <span class="ruby-keyword kw">end</span>
155:     <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">ThrowResult</span>
156:       <span class="ruby-value">0</span>
157:     <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="count-method" class="method-detail ">
				<a name="method-i-count"></a>

				<div class="method-heading">
				
					<span class="method-name">count</span><span
						class="method-args">(column_name = nil, options = {})</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Count operates using three different approaches.
</p>
<ul>
<li><p>
Count all: By not passing any parameters to count, it will return a count
of all the rows for the model.
</p>
</li>
<li><p>
Count using column: By passing a column name to count, it will return a
count of all the rows for the model with supplied column present.
</p>
</li>
<li><p>
Count using options will find the row count matched by the options used.
</p>
</li>
</ul>
<p>
The third approach, count using options, accepts an option hash as the only
parameter. The options are:
</p>
<ul>
<li><p>
<tt>:conditions</tt>: An SQL fragment like &#8220;administrator = 1&#8221;
or [ &#8220;user_name = ?&#8221;, username ]. See conditions in the intro
to <a href="Base.html">ActiveRecord::Base</a>.
</p>
</li>
<li><p>
<tt>:joins</tt>: Either an SQL fragment for additional joins like
&#8220;LEFT JOIN comments ON comments.post_id = id&#8221;  (rarely needed)
or named associations in the same form used for the <tt>:include</tt>
option, which will perform an INNER JOIN on the associated table(s). If the
value is a string, then the records  will be returned read-only since they
will have attributes that do not correspond to the table&#8217;s columns.
Pass <tt>:readonly =&gt; false</tt> to override.
</p>
</li>
<li><p>
<tt>:include</tt>: Named associations that should be loaded alongside using
LEFT OUTER JOINs. The symbols named refer to already defined associations.
When using named associations, count returns the number of DISTINCT items
for the model you&#8217;re counting. See eager loading under Associations.
</p>
</li>
<li><p>
<tt>:order</tt>: An SQL fragment like &#8220;created_at DESC, name&#8221;
(really only used with GROUP BY calculations).
</p>
</li>
<li><p>
<tt>:group</tt>: An attribute name by which the result should be grouped.
Uses the GROUP BY SQL-clause.
</p>
</li>
<li><p>
<tt>:select</tt>: By default, this is * as in SELECT * FROM, but can be
changed if you, for example, want to do a join but not include the joined
columns.
</p>
</li>
<li><p>
<tt>:distinct</tt>: Set this to true to make this a distinct calculation,
such as SELECT COUNT(DISTINCT posts.id) &#8230;
</p>
</li>
<li><p>
<tt>:from</tt> - By default, this is the table name of the class, but can
be changed to an alternate table name (or even the name of a database
view).
</p>
</li>
</ul>
<p>
Examples for counting all:
</p>
<pre>
  Person.count         # returns the total count of all people
</pre>
<p>
Examples for counting by column:
</p>
<pre>
  Person.count(:age)  # returns the total count of all people whose age is present in database
</pre>
<p>
Examples for count with options:
</p>
<pre>
  Person.count(:conditions =&gt; &quot;age &gt; 26&quot;)

  # because of the named association, it finds the DISTINCT count using LEFT OUTER JOIN.
  Person.count(:conditions =&gt; &quot;age &gt; 26 AND job.salary &gt; 60000&quot;, :include =&gt; :job)

  # finds the number of rows matching the conditions and joins.
  Person.count(:conditions =&gt; &quot;age &gt; 26 AND job.salary &gt; 60000&quot;,
               :joins =&gt; &quot;LEFT JOIN jobs on jobs.person_id = person.id&quot;)

  Person.count('id', :conditions =&gt; &quot;age &gt; 26&quot;) # Performs a COUNT(id)
  Person.count(:all, :conditions =&gt; &quot;age &gt; 26&quot;) # Performs a COUNT(*) (:all is an alias for '*')
</pre>
<p>
Note: <tt>Person.count(:all)</tt> will not work because it will use
<tt>:all</tt> as the condition. Use Person.count instead.
</p>
					

					
					<div class="method-source-code"
						id="count-source">
<pre>
    <span class="ruby-comment cmt"># File lib/active_record/relation/calculations.rb, line 56</span>
56:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">count</span>(<span class="ruby-identifier">column_name</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">options</span> = {})
57:       <span class="ruby-identifier">column_name</span>, <span class="ruby-identifier">options</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">column_name</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">column_name</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Hash</span>)
58:       <span class="ruby-identifier">calculate</span>(<span class="ruby-value">:count</span>, <span class="ruby-identifier">column_name</span>, <span class="ruby-identifier">options</span>)
59:     <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="maximum-method" class="method-detail ">
				<a name="method-i-maximum"></a>

				<div class="method-heading">
				
					<span class="method-name">maximum</span><span
						class="method-args">(column_name, options = {})</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Calculates the maximum value on a given column. The value is returned with
the same data type of the column, or <tt>nil</tt> if there&#8217;s no row.
See <tt>calculate</tt> for examples with options.
</p>
<pre>
  Person.maximum('age') # =&gt; 93</pre>
					

					
					<div class="method-source-code"
						id="maximum-source">
<pre>
    <span class="ruby-comment cmt"># File lib/active_record/relation/calculations.rb, line 83</span>
83:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">maximum</span>(<span class="ruby-identifier">column_name</span>, <span class="ruby-identifier">options</span> = {})
84:       <span class="ruby-identifier">calculate</span>(<span class="ruby-value">:maximum</span>, <span class="ruby-identifier">column_name</span>, <span class="ruby-identifier">options</span>)
85:     <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="minimum-method" class="method-detail ">
				<a name="method-i-minimum"></a>

				<div class="method-heading">
				
					<span class="method-name">minimum</span><span
						class="method-args">(column_name, options = {})</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Calculates the minimum value on a given column.  The value is returned with
the same data type of the column, or <tt>nil</tt> if there&#8217;s no row.
See <tt>calculate</tt> for examples with options.
</p>
<pre>
  Person.minimum('age') # =&gt; 7</pre>
					

					
					<div class="method-source-code"
						id="minimum-source">
<pre>
    <span class="ruby-comment cmt"># File lib/active_record/relation/calculations.rb, line 74</span>
74:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">minimum</span>(<span class="ruby-identifier">column_name</span>, <span class="ruby-identifier">options</span> = {})
75:       <span class="ruby-identifier">calculate</span>(<span class="ruby-value">:minimum</span>, <span class="ruby-identifier">column_name</span>, <span class="ruby-identifier">options</span>)
76:     <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="sum-method" class="method-detail ">
				<a name="method-i-sum"></a>

				<div class="method-heading">
				
					<span class="method-name">sum</span><span
						class="method-args">(column_name, options = {})</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Calculates the sum of values on a given column. The value is returned with
the same data type of the column, 0 if there&#8217;s no row. See
<tt>calculate</tt> for examples with options.
</p>
<pre>
  Person.sum('age') # =&gt; 4562</pre>
					

					
					<div class="method-source-code"
						id="sum-source">
<pre>
    <span class="ruby-comment cmt"># File lib/active_record/relation/calculations.rb, line 92</span>
92:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sum</span>(<span class="ruby-identifier">column_name</span>, <span class="ruby-identifier">options</span> = {})
93:       <span class="ruby-identifier">calculate</span>(<span class="ruby-value">:sum</span>, <span class="ruby-identifier">column_name</span>, <span class="ruby-identifier">options</span>)
94:     <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
		</div>
	
		<div id="private-instance-method-details" class="method-section section">
			<h3 class="section-header">Private Instance Methods</h3>

		
			<div id="column-alias-for-method" class="method-detail ">
				<a name="method-i-column_alias_for"></a>

				<div class="method-heading">
				
					<span class="method-name">column_alias_for</span><span
						class="method-args">(*keys)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Converts the given keys to the value that the database adapter returns as a
usable column name:
</p>
<pre>
  column_alias_for(&quot;users.id&quot;)                 # =&gt; &quot;users_id&quot;
  column_alias_for(&quot;sum(id)&quot;)                  # =&gt; &quot;sum_id&quot;
  column_alias_for(&quot;count(distinct users.id)&quot;) # =&gt; &quot;count_distinct_users_id&quot;
  column_alias_for(&quot;count(*)&quot;)                 # =&gt; &quot;count_all&quot;
  column_alias_for(&quot;count&quot;, &quot;id&quot;)              # =&gt; &quot;count_id&quot;</pre>
					

					
					<div class="method-source-code"
						id="column-alias-for-source">
<pre>
     <span class="ruby-comment cmt"># File lib/active_record/relation/calculations.rb, line 246</span>
246:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">column_alias_for</span>(*<span class="ruby-identifier">keys</span>)
247:       <span class="ruby-identifier">table_name</span> = <span class="ruby-identifier">keys</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">' '</span>)
248:       <span class="ruby-identifier">table_name</span>.<span class="ruby-identifier">downcase!</span>
249:       <span class="ruby-identifier">table_name</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp re">/\*/</span>, <span class="ruby-value str">'all'</span>)
250:       <span class="ruby-identifier">table_name</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp re">/\W+/</span>, <span class="ruby-value str">' '</span>)
251:       <span class="ruby-identifier">table_name</span>.<span class="ruby-identifier">strip!</span>
252:       <span class="ruby-identifier">table_name</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp re">/ +/</span>, <span class="ruby-value str">'_'</span>)
253: 
254:       <span class="ruby-ivar">@klass</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">table_alias_for</span>(<span class="ruby-identifier">table_name</span>)
255:     <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="column-for-method" class="method-detail ">
				<a name="method-i-column_for"></a>

				<div class="method-heading">
				
					<span class="method-name">column_for</span><span
						class="method-args">(field)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="column-for-source">
<pre>
     <span class="ruby-comment cmt"># File lib/active_record/relation/calculations.rb, line 257</span>
257:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">column_for</span>(<span class="ruby-identifier">field</span>)
258:       <span class="ruby-identifier">field_name</span> = <span class="ruby-identifier">field</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">'.'</span>).<span class="ruby-identifier">last</span>
259:       <span class="ruby-ivar">@klass</span>.<span class="ruby-identifier">columns</span>.<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">field_name</span> }
260:     <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="perform-calculation-method" class="method-detail ">
				<a name="method-i-perform_calculation"></a>

				<div class="method-heading">
				
					<span class="method-name">perform_calculation</span><span
						class="method-args">(operation, column_name, options = {})</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="perform-calculation-source">
<pre>
     <span class="ruby-comment cmt"># File lib/active_record/relation/calculations.rb, line 161</span>
161:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">perform_calculation</span>(<span class="ruby-identifier">operation</span>, <span class="ruby-identifier">column_name</span>, <span class="ruby-identifier">options</span> = {})
162:       <span class="ruby-identifier">operation</span> = <span class="ruby-identifier">operation</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">downcase</span>
163: 
164:       <span class="ruby-identifier">distinct</span> = <span class="ruby-keyword kw">nil</span>
165: 
166:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">operation</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;count&quot;</span>
167:         <span class="ruby-identifier">column_name</span> <span class="ruby-operator">||=</span> (<span class="ruby-identifier">select_for_count</span> <span class="ruby-operator">||</span> <span class="ruby-value">:all</span>)
168: 
169:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">arel</span>.<span class="ruby-identifier">joins</span>(<span class="ruby-identifier">arel</span>) <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/LEFT OUTER/</span>
170:           <span class="ruby-identifier">distinct</span> = <span class="ruby-keyword kw">true</span>
171:           <span class="ruby-identifier">column_name</span> = <span class="ruby-ivar">@klass</span>.<span class="ruby-identifier">primary_key</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">column_name</span> <span class="ruby-operator">==</span> <span class="ruby-value">:all</span>
172:         <span class="ruby-keyword kw">end</span>
173: 
174:         <span class="ruby-identifier">distinct</span> = <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">column_name</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/\s*DISTINCT\s+/</span>
175:       <span class="ruby-keyword kw">end</span>
176: 
177:       <span class="ruby-identifier">distinct</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:distinct</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">distinct</span>
178:       <span class="ruby-identifier">column_name</span> = <span class="ruby-value">:all</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">column_name</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">operation</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;count&quot;</span>
179: 
180:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@group_values</span>.<span class="ruby-identifier">any?</span>
181:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">execute_grouped_calculation</span>(<span class="ruby-identifier">operation</span>, <span class="ruby-identifier">column_name</span>)
182:       <span class="ruby-keyword kw">else</span>
183:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">execute_simple_calculation</span>(<span class="ruby-identifier">operation</span>, <span class="ruby-identifier">column_name</span>, <span class="ruby-identifier">distinct</span>)
184:       <span class="ruby-keyword kw">end</span>
185:     <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="select-for-count-method" class="method-detail ">
				<a name="method-i-select_for_count"></a>

				<div class="method-heading">
				
					<span class="method-name">select_for_count</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="select-for-count-source">
<pre>
     <span class="ruby-comment cmt"># File lib/active_record/relation/calculations.rb, line 279</span>
279:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">select_for_count</span>
280:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@select_values</span>.<span class="ruby-identifier">present?</span>
281:         <span class="ruby-identifier">select</span> = <span class="ruby-ivar">@select_values</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;, &quot;</span>)
282:         <span class="ruby-identifier">select</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">select</span> <span class="ruby-operator">!~</span> <span class="ruby-regexp re">/(,|\*)/</span>
283:       <span class="ruby-keyword kw">end</span>
284:     <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="type-cast-calculated-value-method" class="method-detail ">
				<a name="method-i-type_cast_calculated_value"></a>

				<div class="method-heading">
				
					<span class="method-name">type_cast_calculated_value</span><span
						class="method-args">(value, column, operation = nil)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="type-cast-calculated-value-source">
<pre>
     <span class="ruby-comment cmt"># File lib/active_record/relation/calculations.rb, line 262</span>
262:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">type_cast_calculated_value</span>(<span class="ruby-identifier">value</span>, <span class="ruby-identifier">column</span>, <span class="ruby-identifier">operation</span> = <span class="ruby-keyword kw">nil</span>)
263:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">nil?</span>
264:         <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">operation</span>
265:           <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'count'</span>   <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">to_i</span>
266:           <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'sum'</span>     <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">type_cast_using_column</span>(<span class="ruby-identifier">value</span> <span class="ruby-operator">||</span> <span class="ruby-value str">'0'</span>, <span class="ruby-identifier">column</span>)
267:           <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'average'</span> <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">try</span>(<span class="ruby-value">:to_d</span>)
268:           <span class="ruby-keyword kw">else</span> <span class="ruby-identifier">type_cast_using_column</span>(<span class="ruby-identifier">value</span>, <span class="ruby-identifier">column</span>)
269:         <span class="ruby-keyword kw">end</span>
270:       <span class="ruby-keyword kw">else</span>
271:         <span class="ruby-identifier">value</span>
272:       <span class="ruby-keyword kw">end</span>
273:     <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="type-cast-using-column-method" class="method-detail ">
				<a name="method-i-type_cast_using_column"></a>

				<div class="method-heading">
				
					<span class="method-name">type_cast_using_column</span><span
						class="method-args">(value, column)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="type-cast-using-column-source">
<pre>
     <span class="ruby-comment cmt"># File lib/active_record/relation/calculations.rb, line 275</span>
275:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">type_cast_using_column</span>(<span class="ruby-identifier">value</span>, <span class="ruby-identifier">column</span>)
276:       <span class="ruby-identifier">column</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">column</span>.<span class="ruby-identifier">type_cast</span>(<span class="ruby-identifier">value</span>) <span class="ruby-operator">:</span> <span class="ruby-identifier">value</span>
277:     <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
		</div>
	

	</div>


	<div id="rdoc-debugging-section-dump" class="debugging-section">
	
		<p>Disabled; run with --debug to generate this.</p>
	
	</div>

	<div id="validator-badges">
		<p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
		<p><small>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish
			Rdoc Generator</a> 1.1.6</small>.</p>
	</div>

</body>
</html>

